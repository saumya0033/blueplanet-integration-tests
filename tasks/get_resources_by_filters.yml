- name: set the query
  set_fact:
    cacheable: false
    query: "{{ lookup('template', './templates/get_resource_by_filters.j2') }}"
- name: print query
  debug:
    msg: "query: {{ query }}"
    verbosity: 3
- name: 'get resources'
  vars:
    query: "{{ lookup('template', './templates/get_resource_by_filters.j2') }}"
  uri:
    url: "{{ bp_integration_tests_server }}/bpocore/market/api/v1/resources{{ query }}"
    method: GET
    validate_certs: no
    headers:
      Content-Type: application/json
      Authorization: "Bearer {{ bp_integration_tests_token }}"
  register: result
- name: Set the resources Fact
  set_fact:
    cacheable: false
    resources: "{{ result.json['items'] }}"
- name: print resources
  debug:
    msg: "resources: {{ resources }}"
    verbosity: 3

# - name: Set bp_keyed_resources fact
#   block:
#   - name: Set bp_keyed_resources fact
#     set_fact:
#       cacheable: false
#       tmp: "{{ result.json['items'] }}"
#   - name: Set bp_keyed_resources fact
#     set_fact:
#       cacheable: true
#       bp_keyed_products: "{{ tmp | items2dict(key_name='resourceTypeId', value_name='id') }}"
#   - name: print bp_keyed_products
#     debug:
#       msg: "bp_keyed_products: {{ bp_keyed_products }}"
#       verbosity: 3
